---
- hosts: localhost
  connection: local
  gather_facts: no

  vars_files:
    - devops/reinstall/vars/global_settings.yml
    - devops/reinstall/vars/environments/global_env.yml
  vars:
    staging: sites/default/config/staging
    exclude:
      # Here is the list of all core config files.
      # For example, let's assume you wish to export `system.date.yml` to the profile config.
      # 1. Remove appropriate line below (comment it or set `status` to `false`)
      # 2. Run config_clean.sh script
      # 3. Please, look  in config_clean.sh to get more info.
      - { name: "core.menu.static_menu_link_overrides.yml", status: true }
      - { name: "core.extension.yml", status: true }
      - { name: "views.view.test_bulk_form.yml", status: true }
      - { name: "action.settings.yml", status: true }
      - { name: "update_test.settings.yml", status: true }
      - { name: "update.settings.yml", status: true }
      - { name: "views.view.sa_contrib_2013_035.yml", status: true }
      - { name: "block.block.test_block.yml", status: true }
      - { name: "test_basetheme.settings.yml", status: true }
      - { name: "core.date_format.fancy.yml", status: true }
      - { name: "test_subtheme.settings.yml", status: true }
      - { name: "update_script_test.settings.yml", status: true }
      - { name: "system.menu.original.yml", status: true }
      - { name: "menu_test.links.action.yml", status: true }
      - { name: "menu_test.menu_item.yml", status: true }
      - { name: "system.menu.changed.yml", status: true }
      - { name: "menu_test.menu_item.yml", status: true }
      - { name: "views.view.test_entity_reference.yml", status: true }
      - { name: "views.view.test_entity_reference_entity_test.yml", status: true }
      - { name: "system.image.test_toolkit.yml", status: true }
      - { name: "core.entity_view_mode.entity_test.full.yml", status: true }
      - { name: "core.entity_view_mode.entity_test.test.yml", status: true }
      - { name: "module_installer_config_test.type.missing_id.yml", status: true }
      - { name: "core.date_format.html_week.yml", status: true }
      - { name: "system.menu.admin.yml", status: true }
      - { name: "system.theme.global.yml", status: true }
      - { name: "core.date_format.html_month.yml", status: true }
      - { name: "core.date_format.html_date.yml", status: true }
      - { name: "system.menu.footer.yml", status: true }
      - { name: "system.date.yml", status: true }
      - { name: "system.cron.yml", status: true }
      - { name: "system.menu.account.yml", status: true }
      - { name: "core.date_format.html_yearless_date.yml", status: true }
      - { name: "system.mail.yml", status: true }
      - { name: "system.diff.yml", status: true }
      - { name: "core.date_format.html_datetime.yml", status: true }
      - { name: "system.authorize.yml", status: true }
      - { name: "system.menu.main.yml", status: true }
      - { name: "system.logging.yml", status: true }
      - { name: "core.date_format.medium.yml", status: true }
      - { name: "system.image.gd.yml", status: true }
      - { name: "core.date_format.long.yml", status: true }
      - { name: "system.menu.tools.yml", status: true }
      - { name: "core.date_format.short.yml", status: true }
      - { name: "system.file.yml", status: true }
      - { name: "system.maintenance.yml", status: true }
      - { name: "system.performance.yml", status: true }
      - { name: "core.date_format.html_time.yml", status: true }
      - { name: "core.date_format.fallback.yml", status: true }
      # Look here! We've set the next file to status false
      # So it will be imported to your profile after running config_clean.sh
      - { name: "system.site.yml", status: false }
      - { name: "system.rss.yml", status: true }
      - { name: "core.date_format.html_year.yml", status: true }
      - { name: "system.image.yml", status: true }
      - { name: "block.block.foobargorilla.yml", status: true }
      - { name: "field.storage.block_content.body.yml", status: true }
      - { name: "core.entity_view_mode.block_content.full.yml", status: true }
      - { name: "simpletest.settings.yml", status: true }
      - { name: "config_translation_test.content.yml", status: true }
      - { name: "menu_ui.settings.yml", status: true }
      - { name: "rest.settings.yml", status: true }
      - { name: "config_test.dynamic.other_module_test_with_dependency.yml", status: true }
      - { name: "config_test.dynamic.dotted.default.yml", status: true }
      - { name: "config_test.dynamic.dotted.default.yml", status: true }
      - { name: "config_test.dynamic.isinstallable.default.yml", status: true }
      - { name: "config_test.dynamic.dotted.default.yml", status: true }
      - { name: "config_test.types.yml", status: true }
      - { name: "config_test.system.yml", status: true }
      - { name: "config_test.no_status.default.yml", status: true }
      - { name: "config_test.system.yml", status: true }
      - { name: "config_test.system.yml", status: true }
      - { name: "config_test.system.yml", status: true }
      - { name: "config_collection_install_test.test.yml", status: true }
      - { name: "config_collection_install_test.test.yml", status: true }
      - { name: "config_collection_install_test.test.yml", status: true }
      - { name: "config_test.dynamic.dotted.default.yml", status: true }
      - { name: "config_schema_test.someschema.with_parents.yml", status: true }
      - { name: "config_schema_test.someschema.somemodule.section_two.subsection.yml", status: true }
      - { name: "config_test.dynamic.third_party.yml", status: true }
      - { name: "config_schema_test.someschema.somemodule.section_one.subsection.yml", status: true }
      - { name: "config_schema_test.someschema.yml", status: true }
      - { name: "config_schema_test.ignore.yml", status: true }
      - { name: "config_schema_test.plugin_types.yml", status: true }
      - { name: "config_schema_test.noschema.yml", status: true }
      - { name: "block.block.config_override_test.yml", status: true }
      - { name: "config_test.dynamic.dotted.english.yml", status: true }
      - { name: "config_test.dynamic.dotted.french.yml", status: true }
      - { name: "config_collection_install_test.test.yml", status: true }
      - { name: "config_collection_install_test.test.yml", status: true }
      - { name: "config_collection_install_test.test.yml", status: true }
      - { name: "config_test.dynamic.dotted.default.yml", status: true }
      - { name: "system.cron.yml", status: true }
      - { name: "block.block.call_to_action.yml", status: true }
      - { name: "config_test.dynamic.dotted.default.yml", status: true }
      - { name: "config_test.dynamic.dotted.default.yml", status: true }
      - { name: "config_test.dynamic.config_integration_test.yml", status: true }
      - { name: "config_integration_test.settings.yml", status: true }
      - { name: "taxonomy.settings.yml", status: true }
      - { name: "core.entity_view_mode.taxonomy_term.full.yml", status: true }
      - { name: "views.settings.yml", status: true }
      - { name: "contact.form.feedback.yml", status: true }
      - { name: "contact.settings.yml", status: true }
      - { name: "contact.form.personal.yml", status: true }
      - { name: "field_ui.settings.yml", status: true }
      - { name: "node.type.default.yml", status: true }
      - { name: "core.entity_view_mode.node.search_index.yml", status: true }
      - { name: "system.action.node_promote_action.yml", status: true }
      - { name: "node.settings.yml", status: true }
      - { name: "system.action.node_unpublish_action.yml", status: true }
      - { name: "core.entity_view_mode.node.search_result.yml", status: true }
      - { name: "system.action.node_delete_action.yml", status: true }
      - { name: "system.action.node_make_unsticky_action.yml", status: true }
      - { name: "system.action.node_unpromote_action.yml", status: true }
      - { name: "core.entity_view_mode.node.full.yml", status: true }
      - { name: "core.entity_view_mode.node.teaser.yml", status: true }
      - { name: "field.storage.node.body.yml", status: true }
      - { name: "core.entity_view_mode.node.rss.yml", status: true }
      - { name: "system.action.node_save_action.yml", status: true }
      - { name: "system.action.node_make_sticky_action.yml", status: true }
      - { name: "system.action.node_publish_action.yml", status: true }
      - { name: "syslog.settings.yml", status: true }
      - { name: "image.style.medium.yml", status: true }
      - { name: "image.settings.yml", status: true }
      - { name: "image.style.large.yml", status: true }
      - { name: "image.style.thumbnail.yml", status: true }
      - { name: "filter.format.filter_test.yml", status: true }
      - { name: "filter.format.filtered_html.yml", status: true }
      - { name: "filter.format.full_html.yml", status: true }
      - { name: "filter.format.plain_text.yml", status: true }
      - { name: "filter.settings.yml", status: true }
      - { name: "shortcut.set.default.yml", status: true }
      - { name: "tracker.settings.yml", status: true }
      - { name: "field.field.node.forum.comment_forum.yml", status: true }
      - { name: "comment.type.comment_forum.yml", status: true }
      - { name: "core.base_field_override.node.forum.title.yml", status: true }
      - { name: "field.field.node.forum.taxonomy_forums.yml", status: true }
      - { name: "field.field.node.forum.body.yml", status: true }
      - { name: "forum.settings.yml", status: true }
      - { name: "field.field.comment.comment_forum.comment_body.yml", status: true }
      - { name: "field.storage.node.comment_forum.yml", status: true }
      - { name: "core.base_field_override.node.forum.promote.yml", status: true }
      - { name: "field.field.taxonomy_term.forums.forum_container.yml", status: true }
      - { name: "field.storage.taxonomy_term.forum_container.yml", status: true }
      - { name: "core.entity_view_display.taxonomy_term.forums.default.yml", status: true }
      - { name: "taxonomy.vocabulary.forums.yml", status: true }
      - { name: "node.type.forum.yml", status: true }
      - { name: "core.entity_view_display.node.forum.default.yml", status: true }
      - { name: "field.storage.node.taxonomy_forums.yml", status: true }
      - { name: "core.entity_form_display.taxonomy_term.forums.default.yml", status: true }
      - { name: "core.entity_form_display.node.forum.default.yml", status: true }
      - { name: "core.entity_view_display.node.forum.teaser.yml", status: true }
      - { name: "core.entity_form_display.comment.comment_forum.default.yml", status: true }
      - { name: "core.entity_view_display.comment.comment_forum.default.yml", status: true }
      - { name: "field.storage.entity_test.field_test_import.yml", status: true }
      - { name: "field.field.entity_test.entity_test.field_test_import.yml", status: true }
      - { name: "field.field.entity_test.entity_test.field_test_import_2.yml", status: true }
      - { name: "field.field.entity_test.test_bundle.field_test_import_2.yml", status: true }
      - { name: "field.storage.entity_test.field_test_import_2.yml", status: true }
      - { name: "field.settings.yml", status: true }
      - { name: "aggregator_test.settings.yml", status: true }
      - { name: "core.entity_view_mode.aggregator_item.summary.yml", status: true }
      - { name: "core.entity_view_display.aggregator_feed.aggregator_feed.default.yml", status: true }
      - { name: "core.entity_view_display.aggregator_item.aggregator_item.summary.yml", status: true }
      - { name: "aggregator.settings.yml", status: true }
      - { name: "core.entity_view_mode.aggregator_feed.summary.yml", status: true }
      - { name: "core.entity_view_display.aggregator_feed.aggregator_feed.summary.yml", status: true }
      - { name: "locale_test_translate.settings.yml", status: true }
      - { name: "locale_test.translation.yml", status: true }
      - { name: "locale_test.translation.yml", status: true }
      - { name: "locale_test.no_translation.yml", status: true }
      - { name: "locale.settings.yml", status: true }
      - { name: "user.role.authenticated.yml", status: true }
      - { name: "core.entity_view_mode.user.full.yml", status: true }
      - { name: "user.mail.yml", status: true }
      - { name: "system.action.user_cancel_user_action.yml", status: true }
      - { name: "system.action.user_unblock_user_action.yml", status: true }
      - { name: "user.flood.yml", status: true }
      - { name: "core.entity_form_mode.user.register.yml", status: true }
      - { name: "user.role.anonymous.yml", status: true }
      - { name: "system.action.user_block_user_action.yml", status: true }
      - { name: "core.entity_view_mode.user.compact.yml", status: true }
      - { name: "user.settings.yml", status: true }
      - { name: "dblog.settings.yml", status: true }
      - { name: "node.type.book.yml", status: true }
      - { name: "core.entity_view_mode.node.print.yml", status: true }
      - { name: "field.field.node.book.body.yml", status: true }
      - { name: "book.settings.yml", status: true }
      - { name: "core.base_field_override.node.book.promote.yml", status: true }
      - { name: "core.entity_view_display.node.book.teaser.yml", status: true }
      - { name: "core.entity_view_display.node.book.default.yml", status: true }
      - { name: "core.entity_form_display.node.book.default.yml", status: true }
      - { name: "system.action.comment_publish_action.yml", status: true }
      - { name: "system.action.comment_save_action.yml", status: true }
      - { name: "system.action.comment_unpublish_action.yml", status: true }
      - { name: "core.entity_view_mode.comment.full.yml", status: true }
      - { name: "field.storage.comment.comment_body.yml", status: true }
      - { name: "statistics.settings.yml", status: true }
      - { name: "text.settings.yml", status: true }
      - { name: "automated_cron.settings.yml", status: true }
      - { name: "search.page.dummy_search_type.yml", status: true }
      - { name: "search.settings.yml", status: true }
      - { name: "language_config_override_test.settings.yml", status: true }
      - { name: "language.entity.en.yml", status: true }
      - { name: "language.types.yml", status: true }
      - { name: "language.mappings.yml", status: true }
      - { name: "language.negotiation.yml", status: true }
      - { name: "language.entity.und.yml", status: true }
      - { name: "language.entity.zxx.yml", status: true }
      - { name: "core.entity_form_display.node.options_install_test.default.yml", status: true }
      - { name: "field.field.node.options_install_test.body.yml", status: true }
      - { name: "node.type.options_install_test.yml", status: true }
      - { name: "field.storage.node.field_options_float.yml", status: true }
      - { name: "core.entity_view_display.node.options_install_test.default.yml", status: true }
      - { name: "core.entity_view_display.node.options_install_test.teaser.yml", status: true }
      - { name: "field.field.node.options_install_test.field_options_float.yml", status: true }
      - { name: "file.settings.yml", status: true }
      - { name: "tour.tour.tour-test-2.yml", status: true }
      - { name: "tour.tour.tour-test.yml", status: true }
      - { name: "tour.tour.tour-test.yml", status: true }
      - { name: "language.entity.de.yml", status: true }
      - { name: "language.entity.es.yml", status: true }
      - { name: "block.block.stark_local_tasks.yml", status: true }
      - { name: "block.block.stark_branding.yml", status: true }
      - { name: "block.block.stark_admin.yml", status: true }
      - { name: "block.block.stark_local_actions.yml", status: true }
      - { name: "block.block.stark_tools.yml", status: true }
      - { name: "block.block.stark_page_title.yml", status: true }
      - { name: "block.block.stark_login.yml", status: true }
      - { name: "block.block.stark_messages.yml", status: true }
      - { name: "block.block.bartik_footer.yml", status: true }
      - { name: "field.storage.node.field_tags.yml", status: true }
      - { name: "block.block.bartik_tools.yml", status: true }
      - { name: "core.entity_form_display.node.page.default.yml", status: true }
      - { name: "block.block.bartik_breadcrumbs.yml", status: true }
      - { name: "core.entity_form_display.block_content.basic.default.yml", status: true }
      - { name: "rdf.mapping.node.article.yml", status: true }
      - { name: "comment.type.comment.yml", status: true }
      - { name: "editor.editor.basic_html.yml", status: true }
      #- { name: "block.block.seven_local_actions.yml", status: true }
      - { name: "block.block.bartik_powered.yml", status: true }
      - { name: "core.entity_view_display.node.article.teaser.yml", status: true }
      - { name: "system.cron.yml", status: true }
      - { name: "core.entity_form_display.node.article.default.yml", status: true }
      #- { name: "block.block.seven_messages.yml", status: true }
      - { name: "field.field.node.article.field_tags.yml", status: true }
      - { name: "core.entity_view_display.node.article.rss.yml", status: true }
      - { name: "field.storage.node.comment.yml", status: true }
      - { name: "field.field.node.article.body.yml", status: true }
      - { name: "node.type.page.yml", status: true }
      - { name: "core.entity_view_display.block_content.basic.default.yml", status: true }
      #- { name: "block.block.seven_login.yml", status: true }
      - { name: "field.field.comment.comment.comment_body.yml", status: true }
      - { name: "field.field.block_content.basic.body.yml", status: true }
      #- { name: "block.block.seven_page_title.yml", status: true }
      - { name: "block.block.bartik_messages.yml", status: true }
      - { name: "core.entity_view_display.node.article.default.yml", status: true }
      - { name: "editor.editor.full_html.yml", status: true }
      - { name: "rdf.mapping.taxonomy_term.tags.yml", status: true }
      - { name: "core.entity_view_display.node.page.teaser.yml", status: true }
      #- { name: "system.theme.yml", status: true }
      - { name: "automated_cron.settings.yml", status: true }
      - { name: "core.entity_form_display.comment.comment.default.yml", status: true }
      - { name: "core.entity_view_display.comment.comment.default.yml", status: true }
      - { name: "rdf.mapping.node.page.yml", status: true }
      - { name: "block.block.bartik_content.yml", status: true }
      - { name: "block.block.bartik_branding.yml", status: true }
      - { name: "filter.format.basic_html.yml", status: true }
      - { name: "filter.format.restricted_html.yml", status: true }
      - { name: "field.storage.node.field_image.yml", status: true }
      - { name: "core.entity_view_display.user.user.default.yml", status: true }
      - { name: "core.entity_view_display.node.page.default.yml", status: true }
      - { name: "taxonomy.vocabulary.tags.yml", status: true }
      - { name: "block.block.bartik_page_title.yml", status: true }
      - { name: "filter.format.full_html.yml", status: true }
      - { name: "block_content.type.basic.yml", status: true }
      - { name: "node.type.article.yml", status: true }
      - { name: "contact.form.feedback.yml", status: true }
      - { name: "user.role.administrator.yml", status: true }
      - { name: "block.block.bartik_main_menu.yml", status: true }
      - { name: "field.field.node.article.comment.yml", status: true }
      - { name: "block.block.bartik_search.yml", status: true }
      - { name: "field.field.user.user.user_picture.yml", status: true }
      - { name: "core.base_field_override.node.page.promote.yml", status: true }
      - { name: "field.field.node.page.body.yml", status: true }
      #- { name: "block.block.seven_secondary_local_tasks.yml", status: true }
      - { name: "block.block.bartik_help.yml", status: true }
      - { name: "field.field.node.article.field_image.yml", status: true }
      - { name: "block.block.bartik_local_tasks.yml", status: true }
      - { name: "block.block.bartik_local_actions.yml", status: true }
      - { name: "core.entity_form_display.user.user.default.yml", status: true }
      - { name: "field.storage.user.user_picture.yml", status: true }
      #- { name: "block.block.seven_primary_local_tasks.yml", status: true }
      #- { name: "block.block.seven_content.yml", status: true }
      #- { name: "block.block.seven_help.yml", status: true }
      - { name: "core.entity_view_display.user.user.compact.yml", status: true }
      #- { name: "block.block.seven_breadcrumbs.yml", status: true }
      - { name: "block.block.bartik_account_menu.yml", status: true }
      - { name: "rdf.mapping.comment.comment.yml", status: true }
      - { name: "language.entity.de.yml", status: true }
      - { name: "language.entity.es.yml", status: true }
      - { name: "system.cron.yml", status: true }
      - { name: "system.action.user_block_user_action.yml", status: true }
      - { name: "tour.tour.language.yml", status: true }

      - { name: "config_devel.settings.yml", status: true }
      - { name: "devel.settings.yml", status: true }
      - { name: "system.menu.devel.yml", status: true }

  tasks:
    - name: Export config
      shell: drush config-export staging -y

    - name: Remove excluded config files
      file:
        path: '{{ staging }}/{{ item.name }}'
        state: absent
      with_items: exclude
      when: true == {{ item.status }}

    - name: Copy config to profile
      when: workflow_type == 'profile'
      synchronize:
        src: '{{ staging }}/'
        dest: profiles/{{ installation_profile_name }}/config/install
        delete: yes
        rsync_opts:
          - '--exclude=.htaccess'

    - name: Clean staging directory
      when: workflow_type == 'profile'
      shell: 'rm *.yml'
      args:
        chdir: '{{ staging }}'
